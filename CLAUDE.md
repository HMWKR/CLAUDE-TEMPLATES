# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

## 1. 프로젝트 개요

**claude-templates**는 Claude Code CLI 협업을 위한 **마스터 템플릿 저장소**입니다.

새로운 프로젝트에서 Claude와 효과적으로 협업하기 위한 템플릿, 규칙, 가이드라인, 자동화 설정을 한곳에 모아둔 "씨앗 저장소"입니다.

### 핵심 기능

1. **CLAUDE.md 템플릿** - 새 프로젝트에 복사할 19개 섹션 전체 템플릿
2. **16개 섹션 커밋 검증** - Husky + Commitlint 자동화 시스템
3. **프롬프트 패턴 가이드** - 검증된 대화 패턴 모음
4. **5계층 48점 품질 평가** - 객관적 프롬프트 품질 측정 시스템

### 기술 스택

- Node.js (npm)
- Husky (Git 훅)
- Commitlint (커밋 메시지 검증)
- Markdown (문서)

---

## 2. Quick Start

### 새 프로젝트에 적용하기

```bash
# 1. 템플릿 복사 (Windows)
copy C:\Users\jusan\Desktop\claude-templates\CLAUDE_TEMPLATE.md .\CLAUDE.md

# 2. 커밋 검증 시스템 설치
npm install -D husky @commitlint/cli @commitlint/config-conventional
npx husky init

# 3. 설정 파일 복사
copy C:\Users\jusan\Desktop\claude-templates\commitlint.config.cjs .
copy C:\Users\jusan\Desktop\claude-templates\.gitmessage .

# 4. Git 템플릿 등록
git config commit.template .gitmessage
```

### 주요 명령어

| 명령어 | 설명 |
|--------|------|
| `npm install` | 의존성 설치 |
| `git commit` | 템플릿 기반 커밋 (16개 섹션 검증) |

---

## 3. 아키텍처

### 폴더 구조

```
claude-templates/
├── init-project.sh              # 원클릭 자동 설정 스크립트 (7단계)
├── CLAUDE_TEMPLATE.md           # CLAUDE.md 전체 템플릿 (19개 섹션)
├── CLAUDE_UNIVERSAL_RULES.md    # 공통 규칙 (섹션 9-19 분리본)
├── PROJECT_SETUP_CHECKLIST.md   # 새 프로젝트 설정 체크리스트
├── CONVERSATION_PROMPTS.md      # Claude 대화 프롬프트 패턴 모음
├── 커밋메시지-16섹션-설정가이드.md  # 커밋 검증 시스템 상세 가이드
├── package.json                 # Husky + Commitlint 의존성
├── commitlint.config.cjs        # 16개 섹션 검증 규칙
├── .gitmessage                  # 커밋 메시지 템플릿
├── .husky/                      # Git 훅 설정
│   └── commit-msg               # 커밋 메시지 검증 훅
├── scripts/                     # 자동화 스크립트
│   └── extract-local-prompts.js # 프롬프트 추출 스크립트
├── .github/                     # GitHub 설정
│   └── workflows/
│       └── sync-prompts.yml     # 프롬프트 자동 동기화 워크플로우
└── node_modules/                # npm 패키지
```

### 파일 관계도

```
┌─────────────────────────────────────────────────────────────────┐
│                    claude-templates 저장소                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────┐                                          │
│  │ init-project.sh  │ ─────────▶ 새 프로젝트에 7단계 자동 설정  │
│  └──────────────────┘                                          │
│           │ 다운로드                                            │
│           ▼                                                     │
│  ┌──────────────────┐    복사     ┌──────────────────┐         │
│  │ CLAUDE_TEMPLATE  │ ─────────▶  │ 새 프로젝트      │         │
│  │      .md         │             │ CLAUDE.md        │         │
│  └──────────────────┘             └──────────────────┘         │
│                                                                 │
│  ┌──────────────────┐    설정     ┌──────────────────┐         │
│  │ 커밋메시지-16섹션│ ─────────▶  │ commitlint       │         │
│  │ -설정가이드.md   │             │  .config.cjs     │         │
│  └──────────────────┘             └──────────────────┘         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│               분산 Push 프롬프트 수집 아키텍처                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  새 프로젝트 (init-project.sh로 생성)                          │
│  ├── sync-prompts.yml      ← 자동 생성                         │
│  └── extract-local-prompts.js  ← 자동 다운로드                 │
│           │                                                     │
│           │ git push                                            │
│           ▼                                                     │
│  ┌──────────────────┐                                          │
│  │ GitHub Actions   │  프롬프트 추출 실행                       │
│  │ sync-prompts.yml │                                          │
│  └──────────────────┘                                          │
│           │                                                     │
│           ▼                                                     │
│  ┌──────────────────┐                                          │
│  │   gh-pages 배포   │  prompts.json                           │
│  └──────────────────┘                                          │
│           │                                                     │
│           ▼                                                     │
│  ┌──────────────────┐                                          │
│  │ prompt-dashboard │  브라우저에서 모든 프로젝트 집계          │
│  └──────────────────┘                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 핵심 모듈

### 4.1 CLAUDE_TEMPLATE.md

**위치**: `CLAUDE_TEMPLATE.md`

새 프로젝트의 `CLAUDE.md`로 복사할 전체 템플릿입니다.

**구조**:
- 섹션 1-8: 프로젝트별 정보 (TODO 작성 필요)
- 섹션 9-19: 공통 규칙 (그대로 사용)

**사용법**:
```bash
# 새 프로젝트에 복사
cp CLAUDE_TEMPLATE.md /path/to/new-project/CLAUDE.md

# 섹션 1-8 작성
# [TODO] 표시된 부분을 프로젝트에 맞게 수정
```

### 4.2 CLAUDE_UNIVERSAL_RULES.md

**위치**: `CLAUDE_UNIVERSAL_RULES.md`

프로젝트 독립적인 공통 규칙 (섹션 9-19)만 분리한 파일입니다.

**포함 내용**:
- 언어 및 스타일 규칙
- 환각 방지 프로토콜
- Ultrathink 8단계 워크플로우
- 코드 작성/리뷰/테스트 규칙
- 커밋 메시지 16개 섹션 구조

### 4.3 CONVERSATION_PROMPTS.md

**위치**: `CONVERSATION_PROMPTS.md`

Claude와 효과적으로 대화하기 위한 검증된 프롬프트 패턴 모음입니다.

**카테고리**:
- 기본 작업 모드 (Ultrathink, 계획, 검수)
- 기능 구현 / 버그 수정 프롬프트
- 코드 리뷰 / 리팩토링 프롬프트
- 성능 최적화 / 테스트 작성 프롬프트
- 5계층 48점 품질 평가 프롬프트

### 4.4 커밋메시지-16섹션-설정가이드.md

**위치**: `커밋메시지-16섹션-설정가이드.md`

Husky + Commitlint를 사용한 16개 필수 섹션 커밋 메시지 검증 시스템 설정 가이드입니다.

**포함 내용**:
- 패키지 설치 명령어
- `commitlint.config.cjs` 전체 코드
- `.gitmessage` 템플릿
- GitHub Actions CI 설정

### 4.5 extract-local-prompts.js

**위치**: `scripts/extract-local-prompts.js`

16개 섹션 커밋 메시지에서 프롬프트 정보를 추출하는 Node.js 스크립트입니다.

**기능**:
- Git 로그에서 16개 섹션이 포함된 커밋 탐지
- 원본 프롬프트, 최적화된 프롬프트, 분석, 품질 점수 추출
- `prompts.json` 파일로 출력

**사용법**:
```bash
node scripts/extract-local-prompts.js
# → prompts.json 생성
```

### 4.6 sync-prompts.yml

**위치**: `.github/workflows/sync-prompts.yml`

푸시 시 자동으로 프롬프트를 추출하고 gh-pages에 배포하는 GitHub Actions 워크플로우입니다.

**트리거**:
- `main` 또는 `master` 브랜치 푸시
- 수동 실행 (`workflow_dispatch`)

**동작 흐름**:
1. 저장소 체크아웃 (전체 히스토리)
2. Node.js 설정
3. `extract-local-prompts.js` 실행
4. `prompts.json`을 gh-pages 브랜치에 배포

**필수 설정**:
- Repository Settings → Pages → Source: gh-pages 브랜치

### 4.7 prompt-library 연동

**위치**: 외부 저장소 `HMWKR/prompt-library`

prompt-dashboard가 프로젝트 목록을 가져오는 중앙 저장소입니다.

**역할**:
- `data/projects.json`: 모든 등록된 프로젝트 목록 관리
- 각 프로젝트의 `promptsUrl` 제공 (gh-pages URL)
- prompt-dashboard가 이 목록을 기반으로 모든 프로젝트의 `prompts.json`을 fetch하여 집계

**projects.json 구조**:
```json
{
  "version": "2.0",
  "architecture": "distributed-push",
  "projects": [
    {
      "name": "프로젝트명",
      "repo": "owner/repo",
      "owner": "owner",
      "promptsUrl": "https://owner.github.io/repo/prompts.json"
    }
  ]
}
```

**새 프로젝트 등록 방법**:
1. prompt-library 저장소에 PR 생성
2. `data/projects.json`에 프로젝트 정보 추가
3. 머지 후 자동으로 prompt-dashboard에서 집계됨

---

## 5. 타입 시스템

> 이 저장소는 문서 템플릿 저장소로, 별도의 타입 시스템이 없습니다.

---

## 6. 테스트

### 커밋 메시지 검증 테스트

```bash
# 실패 테스트 (섹션 누락)
git commit -m "test"
# → 필수 섹션 누락 오류 발생해야 정상

# 성공 테스트 (전체 구조)
git commit  # 템플릿 표시 → 16개 섹션 작성 → 저장
# → 커밋 성공
```

### 테스트 현황

| 영역 | 테스트 방법 | 예상 결과 |
|------|------------|----------|
| commitlint | 빈 커밋 메시지 | 오류 |
| commitlint | 헤더만 있는 메시지 | 필수 섹션 누락 오류 |
| commitlint | 16개 섹션 완비 | 통과 |

---

## 7. 환경 설정

### 의존성

| 패키지 | 버전 | 용도 |
|--------|------|------|
| `husky` | ^9.0.0 | Git 훅 관리 |
| `@commitlint/cli` | ^19.0.0 | 커밋 메시지 린트 |
| `@commitlint/config-conventional` | ^19.0.0 | 기본 규칙 |

### Git 설정

| 설정 | 값 | 용도 |
|------|-----|------|
| `commit.template` | `.gitmessage` | 커밋 템플릿 |

---

## 8. 알려진 이슈 & TODO

### 현재 제한사항

- [ ] commitlint.config.cjs, .gitmessage 파일이 저장소에 포함되어 있는지 확인 필요
- [ ] macOS/Linux용 설정 스크립트 추가

### 향후 개선 계획

- [ ] 언어별 템플릿 추가 (Python, Go, Rust)
- [ ] VS Code 확장 연동 가이드
- [ ] GitHub Copilot 연동 가이드
- [ ] MCP 서버 설정 템플릿

---

# Claude 작업 지침

이 문서는 Claude Code CLI가 이 프로젝트에서 작업할 때 반드시 따라야 하는 규칙과 원칙을 정의합니다.

---

## 9. 언어 및 스타일

- 모든 대화 및 출력은 **한국어**로 작성
- **기술문서 스타일** (명확·간결·구조적)
- 설명 순서: **용어 정의 → 목적 → 원리 → 예시**
- 문제 설명: **단계별(step-by-step)** 형식

---

## 9-1. 환각 방지 프로토콜 (Anti-Hallucination Protocol) — 필수

모든 작업에서 **검증되지 않은 정보를 사실처럼 제시하는 것**을 방지한다.

### 핵심 원칙: Read Before Write

| 단계 | 행동 | 금지 |
|:----:|------|------|
| 1 | 파일 언급 전 **반드시 Read/Glob으로 확인** | 존재 여부 추정 금지 |
| 2 | 함수/변수명은 **실제 코드에서 복사** | 기억에 의존한 이름 금지 |
| 3 | 라인 번호 언급 시 **실제 확인 후 기재** | 추정 라인 번호 금지 |
| 4 | 아키텍처 설명은 **실제 구조 탐색 후** | 일반적 패턴 가정 금지 |

### 불확실성 표시 규칙

| 표시 | 의미 |
|------|------|
| `[검증됨]` | 실제 파일/코드에서 확인 |
| `[추정]` | 패턴 기반 추측 |
| `[미확인]` | 확인이 필요한 정보 |

---

## 10. 문제 해결 프로토콜 (Ultrathink 필수)

> **모든 작업은 ultrathink 모드로 진행한다. 예외 없음.**

### 8단계 워크플로우

| 단계 | 이름 | 행동 |
|:----:|------|------|
| 0 | **CLAUDE.md 확인** | 지침 읽기 및 준수 확인 |
| 1 | **코드베이스 탐색** | Glob/Grep으로 관련 파일 찾기 |
| 2 | **핵심 파일 읽기** | Read로 실제 코드 확인 |
| 3 | **문제 재정의** | 모호한 요청 명확화 |
| 4 | **루트 원인 분석** | 증상 → 원인 → 영향 범위 |
| 5 | **해결 옵션 제시** | 최소 2개 + 추천 1개 |
| 6 | **계획 승인** | 사용자 확인 후 진행 |
| 7 | **코드 작성** | 검증된 정보 기반 구현 |
| 8 | **검증 및 테스트** | 실행/테스트로 확인 |

---

## 11. 코드 작성 규칙

- 기존 파일명, 디렉토리 구조, 코드 스타일 **유지**
- 새 파일 생성 시 **사용자 승인 필수**
- 한국어 주석 ("무엇을/왜" 중심)
- Magic Number/String **금지** → 상수로 분리
- 기존 기능 호환성 **검증 필수**
- **미사용 변수**: `_` 접두사 + TODO 주석

---

## 12. 커밋 메시지 규칙

커밋 메시지에는 반드시 다음 **16개 섹션**을 포함한다:

### 필수 섹션 (16개)

| # | 섹션 | 용도 |
|:-:|------|------|
| 1 | `[type]:` 헤더 | 커밋 타입 (feat/fix/docs 등) |
| 2 | `## 산출물` | 변경된 파일 목록 |
| 3 | `## 변경 영향도` | 영향 범위, 사용자 영향, 위험도 |
| 4 | `## 테스트 전략` | 검증 방법 체크리스트 |
| 5 | `## 롤백 계획` | 복구 방법 및 의존성 |
| 6 | `## 관련 이슈` | 이슈 링크 (Closes/Related to) |
| 7 | `## Breaking Changes` | 호환성 변경 및 마이그레이션 |
| 8 | `## 성능 벤치마크` | Before/After 테이블 |
| 9 | `## 아키텍처 다이어그램` | ASCII 코드 구조/흐름도 |
| 10 | `## UI/UX 와이어프레임` | ASCII UI 레이아웃 |
| 11 | `## 사고 여정` | Claude 사고 과정 스토리텔링 |
| 12 | `### 원본 프롬프트` | 사용자 입력 그대로 |
| 13 | `### 프롬프트 분석` | 해석/작업유형/제약/키워드 |
| 14 | `### 최적화된 프롬프트` | 개선된 프롬프트 |
| 15 | `## 프롬프트 품질 검수` | 5계층 48점 평가 시스템 |
| 16 | `Co-Authored-By:` | AI 협업 표시 |

> 자동 검증: Husky + Commitlint가 커밋 시 16개 필수 섹션을 검사합니다.

---

## 12-1. 프롬프트 품질 검수 시스템

### 5계층 48점 평가 시스템

```
┌─────────────────────────────────────────────────────────────┐
│  계층 5: 할루시네이션 검증 (12점) - 게이트키퍼               │
│  ├─ 코드/파일 정확성 (4점)                                  │
│  ├─ 기술 정보 정확성 (4점)                                  │
│  ├─ 논리/추론 정확성 (2점)                                  │
│  └─ 검증 프로세스 (2점)                                     │
├─────────────────────────────────────────────────────────────┤
│  계층 4: 효과 검증 (4점)                                    │
│  └─ 예상 개선, 측정 가능성, 부작용 분석, 대안 비교          │
├─────────────────────────────────────────────────────────────┤
│  계층 3: 맥락 최적화 (6점)                                  │
│  ├─ 프로젝트 맥락 (2점)                                     │
│  ├─ 사용자 맥락 (2점)                                       │
│  └─ 도메인 맥락 (2점)                                       │
├─────────────────────────────────────────────────────────────┤
│  계층 2: 엔지니어링 기법 (8점)                              │
│  └─ CoT, Few-shot, Role, Negative, Format, Self-verify,    │
│     Task Decomposition, Context Priming                     │
├─────────────────────────────────────────────────────────────┤
│  계층 1: 구조적 완성도 (18점) - 필수 100%                   │
│  ├─ 명확성 (3점): 단일목적, 행동동사, 모호성제거            │
│  ├─ 구체성 (3점): 정량화, 범위한정, 예시포함                │
│  ├─ 맥락 (3점): 배경설명, 제약명시, 기대산출물              │
│  ├─ 구조화 (3점): 논리순서, 계층구조, 시각분리              │
│  ├─ 제약 (3점): 금지사항, 범위제한, 우선순위                │
│  └─ 검증 (3점): 성공기준, 체크리스트, 완료조건              │
└─────────────────────────────────────────────────────────────┘
```

### 등급 체계

| 등급 | 점수 범위 | 비율 | 의미 |
|:----:|:---------:|:----:|------|
| **S** | 46-48 | 96%+ | 최고 품질 |
| **A+** | 42-45 | 88-95% | 우수 |
| **A** | 38-41 | 79-87% | 양호 |
| **B+** | 34-37 | 71-78% | 보통 |
| **B** | 30-33 | 63-70% | 개선 필요 |
| **F** | <30 또는 L1 | - | 재작성 필요 |

### 게이트키퍼 규칙

**Level 1 (치명) 할루시네이션 발생 시 → 자동 F 등급**

| 레벨 | 심각도 | 감점 | 예시 |
|:----:|:------:|:----:|------|
| **L1** | 치명 | 즉시 F | 존재하지 않는 파일/함수 언급 |
| **L2** | 심각 | -4점 | 라인 번호 오류, 버전 불일치 |
| **L3** | 경고 | -2점 | 불완전한 정보, 부정확한 설명 |
| **L4** | 주의 | -1점 | 모호한 표현, 검증 마커 누락 |

### 검증 마커 시스템

| 마커 | 의미 | 사용 시점 |
|------|------|----------|
| `[검증됨]` | Glob/Grep/Read로 확인 | 코드/파일 언급 시 |
| `[문서확인]` | 공식 문서에서 확인 | API/라이브러리 설명 시 |
| `[추정]` | 패턴 기반 추측 | 확인 불가 시 |
| `[미확인]` | 검증 필요 | 추후 검증 예정 시 |
| `[가정]` | 전제 조건 명시 | 가정 기반 추론 시 |

---

## 12-2. Git 브랜치 전략

| 브랜치 유형 | 용도 | 예시 |
|-------------|------|------|
| `main` | 항상 안정, 배포 가능 | - |
| `feature/<기능명>` | 새 기능 개발 | `feature/user-auth` |
| `fix/<버그명>` | 버그 수정 | `fix/login-error` |
| `chore/<작업명>` | 설정/리팩토링/문서 | `chore/update-deps` |

### Claude 자동 Git 워크플로우

코드 변경 작업 시 Claude가 자동으로 수행:
1. 작업 시작: 적절한 브랜치 생성
2. 작업 중: 커밋
3. 작업 완료: 푸시 + PR 생성
4. 머지: Squash merge + 정리

---

## 13. 코드 리뷰 기준

1. 기능적 정확성
2. 예외 처리 및 오류 핸들링
3. 가독성, 유지보수성, 모듈성
4. 중복 코드 여부
5. 보안 취약점
6. 성능 이슈
7. 확장성 및 구조적 일관성
8. 프로젝트 스타일 가이드 준수

---

## 14. 아키텍처 설계 규칙

설계 시 포함 항목:
1. 문제 정의
2. 요구사항 및 제약 조건
3. 아키텍처 개념도
4. 모듈 구조 및 책임
5. 데이터 흐름
6. 장점·단점
7. 확장성, 성능, 유지보수성 고려

**YAGNI 원칙**: 불필요한 복잡도 추가 금지

---

## 15. 장기 안정성 고려

- 트래픽 증가 시 병목 지점 예측
- 캐싱, 비동기 처리, 큐 사용 필요성 평가
- 모니터링 지표 제안
- 장기적 해결책 우선, Quick Fix 시 리스크 명시

---

## 16. 테스트 규칙

기능 구현 후 테스트 제안 필수:
- 정상 케이스
- 예외 케이스
- 경계값 테스트
- Mock/Stubs 필요 여부
- 통합/E2E 테스트 필요성

---

## 17. 보안 규칙

- 모든 사용자 입력 **검증 필수**
- SQL Injection, XSS, CSRF 취약점 자동 지적
- 민감 정보 (토큰, API 키) 코드 포함 **금지**
- 인증/인가 로직 구현 전 **설계 검토**

---

## 18. 문서 자동 업데이트

다음 상황 발생 시 **CLAUDE.md 업데이트 제안**:
- 새로운 개발 규칙 필요 시
- 프로젝트 운영 지침 추가 필요 시
- 장기적 기준 문서화 필요 시

---

## 19. 사고 절차 (필수)

```
[1단계: 요구 분석] - 목표, 제약 조건, 전제 사항 정리
[2단계: 자기 검증] - 대안 검토 및 장단점 비교
[3단계: 정보 부족 판단] - 정보 부족 시 작업 중단 → 질문 제시
[4단계: 반복 사고 루프] - 추가 정보 제공 시 1단계부터 반복
[5단계: 실행 확정] - 불확실성 해소 후 단계별 계획 요약 → 실행
```

---

## 19-1. 검증 체크리스트 (Verification Checklist)

모든 작업 완료 후 **반드시** 다음을 수행:

### 코드 변경 시
- [ ] 파일 경로가 **실제로 존재**하는가?
- [ ] 함수/변수명이 **실제 코드와 일치**하는가?
- [ ] 테스트가 **통과**하는가?

### 자가 검증 질문
> "이 정보를 어디서 확인했는가?"
> - 파일에서 직접 읽음 → OK
> - 일반적 지식 → `[추정]` 표시 필요

---

## Safety Rules (절대 금지 사항)

- 데이터베이스 초기화/리셋/파괴 명령어 절대 금지
- 민감 정보 외부 전송 금지
- 파괴적 변경은 반드시 사용자 승인 후 진행
- 비파괴적 대안 우선 제시

---

## 미션 (Mission)

```
[미션]
너는 내 요청을 수행하는 "전문가 오케스트레이터"다.
목표를 달성하기 위해 먼저 최선의 접근을 제안하고, 실행 산출물을 만들어라.

[환각 방지 최우선 — Anti-Hallucination First]
- 모든 정보는 **검증 후 제시** (Read Before Write)
- 코드를 **읽지 않고 설명하지 않는다**
- 불확실한 정보는 **`[추정]` 표시** 필수
- 파일/함수/라인 번호는 **실제 확인 후 기재**

[필수 준수]
1) 모든 작업은 **ultrathink 모드**로 진행 (예외 없음)
2) 작업 시작 전 **CLAUDE.md 지침 확인** (0단계)
3) 코드 작성 전 **관련 코드 읽기** (1-2단계)
4) 프로젝트 claude.md 지침 100% 준수
5) 분야별 역할 롤플레잉 (PM, Architect, Security, QA, Writer)
6) 질문 최소화, 모호하면 가정 기반 1차 결과물 제시

[진행 절차]
Step A. 목표 1문장 재정의
Step B. 성공/제약 조건/리스크 목록화
Step C. 2~3개 옵션 + 추천 1개 제시
Step D. 최종 산출물 제공
Step E. 자기검수 후 부족한 정보 질문

[출력 형식]
- 제목, 요약, 분석, 해결 코드/단계, 추가 개선점, 질문
```

---

# End of CLAUDE.md

<!--
작성일: 2026-01-12
작성자: Claude Opus 4.5
저장소: claude-templates (Claude 협업 마스터 템플릿 저장소)
-->
